var X=Object.defineProperty;var Y=(a,e,t)=>e in a?X(a,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[e]=t;var n=(a,e,t)=>(Y(a,typeof e!="symbol"?e+"":e,t),t);import{R as d,F as m,S as x,P as u,M as Q,a as w,b as g,c,A as j,D as J,B as Z}from"./game.constant-sV4GMeaH.js";import{c as E,a as ee,b as te,g as se,d as ie}from"./utils-1UuIHXpH.js";let p=document.querySelector("#gameStatusText");function ae(){p=document.querySelector("#gameStatusText")}function T(a){p.innerText=a}function re(a){T(`${a}'s turn`)}function ne(){p.classList.add("text-secondary"),T("Draw!")}function oe(a,e){p.classList.add("text-primary"),T(`${a} wins by capturing ${e}'s king!`)}function le(a){p.classList.add("text-primary"),T(`${a} wins by resignation!`)}function N(a){p.classList.add("text-primary"),T(`${a} wins by time!`)}function he(){p.classList.remove("text-primary"),p.classList.remove("text-secondary")}const ce=["random","greedy","generous"],B="greedy";function L(a,e){return a.getPieces().filter(t=>E(t.isWhite,e))}function ue(a,e){return{piece:a,fileIndex:e[0],rankIndex:e[1]}}function P(a,e){return e.map(t=>ue(a,t))}function k(a,e){const t=L(a,e),s=[];for(const i of t){const{possibleMoves:r,capturablePieces:o}=i.possibleMoves;s.push(...P(i,r)),s.push(...P(i,o))}return s}function de(a,e){const t=L(a,e),s=[];for(const i of t){const{capturablePieces:r}=i.possibleMoves;s.push(...P(i,r))}if(!s.length)for(const i of t){const{possibleMoves:r}=i.possibleMoves;s.push(...P(i,r))}return s}function me(a,e){const t=L(a,e),s=[];for(const i of t){const{possibleMoves:r}=i.possibleMoves;s.push(...P(i,r))}if(!s.length)for(const i of t){const{capturablePieces:r}=i.possibleMoves;s.push(...P(i,r))}return s}function pe(a,e){return k(a,e)}function fe(a,e){return k(a,e)}function ge(a,e,t){switch(t){case"random":return k(a,e);case"greedy":return de(a,e);case"generous":return me(a,e);case"minimax":return pe(a,e);case"alphaBeta":return fe(a,e);default:throw new Error(`Invalid AI type: ${t}`)}}function ye(a,e,t){const s=ge(a,e,t);return s[Math.floor(Math.random()*s.length)]}function S(a,e,t){ee(e)||te(t)||a.push([e,t])}function W(a,e,t,s,i,r){const o=a==null?void 0:a.getPiecesOnSquare(s,i);return o?(o.isWhite!==r&&S(t,s,i),!1):(S(e,s,i),!0)}function ve(a,e,t,s,i,r){const o=a==null?void 0:a.getPiecesOnSquare(s-1,i);o&&o.isWhite!==r&&S(t,s-1,i);const l=a==null?void 0:a.getPiecesOnSquare(s+1,i);return l&&l.isWhite!==r&&S(t,s+1,i),(a==null?void 0:a.getPiecesOnSquare(s,i))?!1:(S(e,s,i),!0)}function C(a){return a?1:-1}class b{constructor(e,t,s,i,r,o){n(this,"name");n(this,"abbreviation");n(this,"isWhite");n(this,"fileIndex");n(this,"rankIndex");n(this,"control");n(this,"hasMoved");n(this,"htmlElement");n(this,"possibleMoves");n(this,"canAttackOponentKing");var l;this.name=e,this.abbreviation=o||((l=e==null?void 0:e[0])==null?void 0:l.toUpperCase()),this.isWhite=t,this.fileIndex=s,this.rankIndex=i,this.control=r,this.hasMoved=!1,this.htmlElement=this.generateHtmlElement(),this.initializeEventListners(),this.possibleMoves=this.getPossibleMoves(),this.possibleMoves={possibleMoves:[],capturablePieces:[]},this.canAttackOponentKing=!1}get oponentsKing(){if(this.control)return this.control.state.getPlayersKing(!this.isWhite)}get isWhitesTurn(){if(this.control)return this.control.state.isWhitesTurn}get isPlayerVsPlayer(){if(this.control)return this.control.state.isPlayerVsPlayer}reEvaluateMoves(){this.possibleMoves=this.getPossibleMoves();const{capturablePieces:e}=this.possibleMoves;this.canAttackOponentKing=e.some(t=>{var s,i;return t[0]===((s=this.oponentsKing)==null?void 0:s.fileIndex)&&t[1]===((i=this.oponentsKing)==null?void 0:i.rankIndex)})}reEvaluateSpecialMoves(){this.addPossibleSpecialMoves()}_addToPossibleAndCapturableMoves(e,t,s,i){return this.control?W(this.control,e,t,s,i,this.isWhite):!1}getPossibleMovesAcrossAxis(e,t){const s=[],i=[];if(e===0&&t===0)return{possibleMoves:s,capturablePieces:i};if(e===0){for(let r=this.rankIndex+t;r<d&&r>=0&&this._addToPossibleAndCapturableMoves(s,i,this.fileIndex,r);r+=t);return{possibleMoves:s,capturablePieces:i}}else if(t===0){for(let r=this.fileIndex+e;r<m&&r>=0&&this._addToPossibleAndCapturableMoves(s,i,r,this.rankIndex);r+=e);return{possibleMoves:s,capturablePieces:i}}else{for(let r=this.fileIndex+e,o=this.rankIndex+t;r<m&&r>=0&&o<d&&o>=0&&this._addToPossibleAndCapturableMoves(s,i,r,o);r+=e,o+=t);return{possibleMoves:s,capturablePieces:i}}}getPossibleMovesAcrossAxes(){const e=[],t=[],{possibleMoves:s,capturablePieces:i}=this.getPossibleMovesAcrossAxis(1,0);e.push(...s),t.push(...i);const{possibleMoves:r,capturablePieces:o}=this.getPossibleMovesAcrossAxis(-1,0);e.push(...r),t.push(...o);const{possibleMoves:l,capturablePieces:h}=this.getPossibleMovesAcrossAxis(0,1);e.push(...l),t.push(...h);const{possibleMoves:A,capturablePieces:f}=this.getPossibleMovesAcrossAxis(0,-1);return e.push(...A),t.push(...f),{possibleMoves:e,capturablePieces:t}}getPossibleMovesAcrossAllDiagonals(){const e=[],t=[],{possibleMoves:s,capturablePieces:i}=this.getPossibleMovesAcrossAxis(1,1);e.push(...s),t.push(...i);const{possibleMoves:r,capturablePieces:o}=this.getPossibleMovesAcrossAxis(1,-1);e.push(...r),t.push(...o);const{possibleMoves:l,capturablePieces:h}=this.getPossibleMovesAcrossAxis(-1,-1);e.push(...l),t.push(...h);const{possibleMoves:A,capturablePieces:f}=this.getPossibleMovesAcrossAxis(-1,1);return e.push(...A),t.push(...f),{possibleMoves:e,capturablePieces:t}}getPossibleMoves(){return{possibleMoves:[],capturablePieces:[]}}addPossibleSpecialMoves(){}generateHtmlElement(){if(this.htmlElement)return this.htmlElement;const e=document.createElement("img"),t=`${this.isWhite?"w":"b"}${this.abbreviation}`;return e.src=`/images/${t}.png`,e.alt=`${this.isWhite?"White":"Black"} ${this.name}`,e.classList.add("chess-board__piece"),e.setAttribute("data-piece",t),e}getHtmlElement(){return this.htmlElement}flip(){this.htmlElement.classList.toggle("chess-board__piece--reverse")}fixPieceOrientation(){this.isWhitesTurn||!this.isPlayerVsPlayer?this.htmlElement.classList.remove("chess-board__piece--reverse"):this.htmlElement.classList.add("chess-board__piece--reverse")}_removeAllHighlights(){for(const e of x)this.removeHighlight(e)}highlight(e){x.includes(e)&&this.htmlElement.classList.add(`chess-board__piece--${e}`)}removeHighlight(e){x.includes(e)&&this.htmlElement.classList.remove(`chess-board__piece--${e}`)}_resetAt(e,t){this.fileIndex=e,this.rankIndex=t,this.hasMoved=!1,this.reEvaluateMoves()}handleResetAt(e,t){this._resetAt(e,t),this.fixPieceOrientation(),this._removeAllHighlights()}moveTo(e,t){this.fileIndex=e,this.rankIndex=t,this.hasMoved||(this.hasMoved=!0),this.reEvaluateMoves()}remove(){return this.htmlElement.remove(),this}setControl(e){this.control=e}initializeEventListners(){const e=this.getHtmlElement();e.addEventListener("click",()=>{var t;(t=this.control)==null||t.handlePieceClickOrDrag(this)}),e.addEventListener("dragstart",()=>{var t;(t=this.control)==null||t.handlePieceClickOrDrag(this)})}}class V extends b{constructor(...e){super(u.BISHOP,...e)}getPossibleMoves(){return this.getPossibleMovesAcrossAllDiagonals()}}function R(a,e){if(a.hasMoved||e.hasMoved||a.isInCheck===!0)return!1;const t=a.fileIndex,s=a.rankIndex,i=e.fileIndex,r=e.rankIndex;if(s!==r||a.isSquareUnderAttack(t,s))return!1;const o=t<i?1:-1;for(let l=t+o;l!==i;l+=o)if(a.isSquareOccupiedOrUnderAttack(l,s))return!1;return!0}function Pe(a,e){const t=[];if(e.hasMoved)return t;const s=a.getPiecesOfName("Rook",e.isWhite).filter(i=>!i.hasMoved);for(const i of s)if(R(e,i)){const r=e.fileIndex,o=i.fileIndex,l=r<o?1:-1;t.push([r+2*l,e.rankIndex])}return t}function be(a,e,t,s){const i=t-e.fileIndex,r=i<0?Q:m-1,o=i<0?1:-1,l=a.getPiece(r,s);!l||!R(e,l)||Math.abs(i)!==2||a.movePiece(l,t+o,s)}class U extends b{constructor(...e){super(u.QUEEN,...e)}getPossibleMoves(){const e=[],t=[],{possibleMoves:s,capturablePieces:i}=this.getPossibleMovesAcrossAxes();e.push(...s),t.push(...i);const{possibleMoves:r,capturablePieces:o}=this.getPossibleMovesAcrossAllDiagonals();return e.push(...r),t.push(...o),{possibleMoves:e,capturablePieces:t}}}class K extends b{constructor(...e){super(u.ROOK,...e)}getPossibleMoves(){return this.getPossibleMovesAcrossAxes()}}class z extends b{constructor(...e){super(u.KNIGHT,...e)}getPossibleMoves(){const e=[],t=[],s=[[-2,-1],[-2,1],[-1,-2],[-1,2],[1,-2],[1,2],[2,-1],[2,1]];for(const i of s){const[r,o]=i;this._addToPossibleAndCapturableMoves(e,t,this.fileIndex+r,this.rankIndex+o)}return{possibleMoves:e,capturablePieces:t}}}class M extends b{constructor(...e){super(u.PAWN,...e)}getPossibleMoves(){var o;const e=[],t=[];if(!this.control)return{possibleMoves:e,capturablePieces:t};const s=C(this.isWhite);ve(this.control,e,t,this.fileIndex,this.rankIndex+s,this.isWhite)&&!this.hasMoved&&W(this.control,e,[],this.fileIndex,this.rankIndex+s*2,this.isWhite);const r=(o=this.control)==null?void 0:o.getEnPassantAvailableAt();return r&&t.push([r.fileIndex,r.rankIndex]),{possibleMoves:e,capturablePieces:t}}promoteTo(e){const t=[this.isWhite,this.fileIndex,this.rankIndex,this.control,e];switch(e){case u.QUEEN:return new U(...t);case u.ROOK:return new K(...t);case u.BISHOP:return new V(...t);case u.KNIGHT:return new z(...t);default:throw new Error("Invalid piece type")}}}function Ae(a,e,t,s){const i=a.getPiece(e-1,t),r=a.getPiece(e+1,t),o=i?i.isWhite!==s&&i instanceof M:!1,l=r?r.isWhite!==s&&r instanceof M:!1;return o||l}function Se(a,e,t){const s=a.getSquare(e,t);s&&a.setEnPassantAvailableAt(s)}function Ee(a,e,t,s){if(Ae(a,e,t,s)){const r=C(s);Se(a,e,t-r*1)}}function Me(a,e,t){if(!a.enPassantAvailableAt)return!1;const{fileIndex:s,rankIndex:i}=a.enPassantAvailableAt;return e!==s||t!==i?!1:(a.enPassantAvailableAt=null,!0)}function Te(a,e,t,s){if(!Me(a,e,t))return null;const i=C(s);return a.getPiece(e,t-i*1)}function Ie(a,e,t,s){const i=Te(a,e,t,s);return i?(a.removePieceAtSquare(e,t-1*C(s)),i):null}function Ce(a,e,t){const{fileIndex:s,rankIndex:i}=e;try{const r=e.promoteTo(t);return a.replacePieceAtSquare(r,s,i),!0}catch{return!1}}class v extends b{constructor(...t){super(u.KING,...t);n(this,"isInCheck");this.isInCheck=!1}getPossibleMoves(){const t=[],s=[];return this._addToPossibleAndCapturableMoves(t,s,this.fileIndex,this.rankIndex+1),this._addToPossibleAndCapturableMoves(t,s,this.fileIndex,this.rankIndex-1),this._addToPossibleAndCapturableMoves(t,s,this.fileIndex+1,this.rankIndex),this._addToPossibleAndCapturableMoves(t,s,this.fileIndex-1,this.rankIndex),this._addToPossibleAndCapturableMoves(t,s,this.fileIndex+1,this.rankIndex+1),this._addToPossibleAndCapturableMoves(t,s,this.fileIndex-1,this.rankIndex-1),this._addToPossibleAndCapturableMoves(t,s,this.fileIndex+1,this.rankIndex-1),this._addToPossibleAndCapturableMoves(t,s,this.fileIndex-1,this.rankIndex+1),{possibleMoves:t,capturablePieces:s}}addPossibleSpecialMoves(){if(!this.control)return;const t=Pe(this.control.state,this);for(const s of t)this.possibleMoves.possibleMoves.push(s)}updateIsInCheck(t){t?this.highlight(w.CHECKED):this.removeHighlight(w.CHECKED),this.isInCheck=t}isSquareOccupiedOrUnderAttack(t,s){return this.control?this.control.state.isSquareOccupiedOrUnderAttack(t,s,this.isWhite):!1}isSquareUnderAttack(t,s){return this.control?this.control.state.isSquareUnderAttack(t,s,this.isWhite):!1}}class _e{constructor(e,t){n(this,"boardElement");n(this,"state");n(this,"highlightedSquares");n(this,"selectedPiece");n(this,"aiThinkingStartTimestamp");this.boardElement=e,this.state=t,this.highlightedSquares=g.reduce((s,i)=>(s[i]=[],s),{}),this.selectedPiece=null,this.aiThinkingStartTimestamp=null,this.handleAIsTurn()}get isWhitesTurn(){return this.state.isWhitesTurn}reset(){this.selectedPiece=null;for(const e of g)this.removeHighlightFromSquare(e)}fixBoardOrientation(){if(this.state.isPlayerVsPlayer){const e=this.boardElement.querySelectorAll(".chess-board__player-name");if(this.state.isWhitesTurn){this.boardElement.classList.remove("chess-board__container--reverse");for(const t of e)t.classList.remove("chess-board__player-name--reverse")}else{this.boardElement.classList.add("chess-board__container--reverse");for(const t of e)t.classList.add("chess-board__player-name--reverse")}for(const t of this.state.getPieces())t.fixPieceOrientation()}}isSquareHighlighted(e,t){var s;return g.includes(t)?((s=this.highlightedSquares[t])==null?void 0:s.includes(e))??!1:!1}highlightSquare(e,t,s){var r;if(!g.includes(s))return;const i=this.state.getSquare(e,t);i&&(i.highlight(s),(r=this.highlightedSquares[s])==null||r.push(i))}removeHighlightFromSquare(e){if(g.includes(e)){for(const t of this.highlightedSquares[e]||[])t.removeHighlight(e);this.highlightedSquares[e]=[]}}handlePieceClickOrDrag(e){if(!this.state.hasGameStarted||this.state.hasGameEnded||e.isWhite!==this.isWhitesTurn)return;this.selectedPiece=e,this.removeHighlightFromSquare(c.SELECTED),this.highlightSquare(e.fileIndex,e.rankIndex,c.SELECTED),this.removeHighlightFromSquare(c.VALID),this.removeHighlightFromSquare(c.CAPTURABLE);const{possibleMoves:t,capturablePieces:s}=e.possibleMoves;for(const[i,r]of t)this.highlightSquare(i,r,c.VALID);for(const[i,r]of s)this.highlightSquare(i,r,c.CAPTURABLE)}_checkIfTargetSquareWasHighlightedAsLegalMove(e,t){var r,o;const s=(r=this.highlightedSquares[c.VALID])==null?void 0:r.some(l=>l.fileIndex===e&&l.rankIndex===t),i=(o=this.highlightedSquares[c.CAPTURABLE])==null?void 0:o.some(l=>l.fileIndex===e&&l.rankIndex===t);return s||i}handleMoveSelectedPieceTo(e,t){if(!this.selectedPiece||!this._checkIfTargetSquareWasHighlightedAsLegalMove(e,t))return;const{fileIndex:s,rankIndex:i,isWhite:r}=this.selectedPiece;if(!this.state.executeMove(this.selectedPiece,e,t))return;this.selectedPiece instanceof M&&(Math.abs(t-i)===2?Ee(this.state,e,t,r):(t===0||t===d-1)&&Ce(this.state,this.selectedPiece,u.QUEEN)),this.removeHighlightFromSquare(c.LAST_MOVE),this.highlightSquare(s,i,c.LAST_MOVE),this.highlightSquare(e,t,c.LAST_MOVE),this.removeHighlightFromSquare(c.SELECTED),this.removeHighlightFromSquare(c.VALID),this.removeHighlightFromSquare(c.CAPTURABLE),this.fixBoardOrientation(),this.selectedPiece=null}getPiecesOnSquare(e,t){return this.state.getPiece(e,t)}getEnPassantAvailableAt(){return this.state.enPassantAvailableAt}handleAIsTurn(){if(this.state.currentPlayer.isComputer&&this.state.hasGameStarted&&!this.state.hasGameEnded&&(this.aiThinkingStartTimestamp=this.aiThinkingStartTimestamp??Date.now(),this.aiThinkingStartTimestamp+j<Date.now())){const{piece:e,fileIndex:t,rankIndex:s}=ye(this.state,this.state.currentPlayer.isWhite,this.state.currentPlayer.aiType);this.handlePieceClickOrDrag(e),this.handleMoveSelectedPieceTo(t,s),this.aiThinkingStartTimestamp=null}requestAnimationFrame(()=>{this.handleAIsTurn()})}}function I(a,e){const t=a.getPlayersKing(e),s=a.getPieces().filter(i=>!(E(i.isWhite,e)||i instanceof v));for(const i of s)if(i.canAttackOponentKing)return t.updateIsInCheck(!0),{isInCheck:!0,king:t,checkBy:i};return t.updateIsInCheck(!1),{isInCheck:!1,king:t,checkBy:null}}class xe{constructor(e,t,s=null){n(this,"fileIndex");n(this,"rankIndex");n(this,"piece");n(this,"htmlElement");this.fileIndex=e,this.rankIndex=t,this.piece=s,this.htmlElement=this.generateHtmlElement()}generateHtmlElement(){if(this.htmlElement)return this.htmlElement;const e=se(this.fileIndex,this.rankIndex),t=document.createElement("div");return t.classList.add("chess-board__square"),t.classList.add(`chess-board__square--${ie(this.fileIndex,this.rankIndex)}`),t.setAttribute("data-square",e),t}getHtmlElement(){return this.htmlElement}highlight(e){g.includes(e)&&this.htmlElement.classList.add(`chess-board__square--${e}`)}removeHighlight(e){g.includes(e)&&this.htmlElement.classList.remove(`chess-board__square--${e}`)}setPiece(e){if(!e){this.htmlElement.innerHTML="";return}this.piece=e,this.htmlElement.appendChild(e.getHtmlElement())}removePiece(){this.piece=null,this.htmlElement.innerHTML=""}}class q{constructor(e,t,s,i=!1){n(this,"name");n(this,"isWhite");n(this,"state");n(this,"isComputer");n(this,"aiType");n(this,"king");this.name=e,this.isWhite=t,this.state=s,this.isComputer=i,this.aiType=i?B:null,this.king=this.state.getPieces().find(r=>r instanceof v&&E(r.isWhite,this.isWhite))}get isTurn(){return E(this.state.isWhitesTurn,this.isWhite)}updateName(e){this.name=e}switchToComputer(e){this.isComputer=!0,this.aiType=e}switchToPlayer(){this.isComputer=!1,this.aiType=null}}const F=["/audios/Move_Piece_1.WAV","/audios/Move_Piece_2.WAV","/audios/Move_Piece_3.WAV","/audios/Move_Piece_4.WAV","/audios/Move_Piece_5.WAV","/audios/Move_Piece_6.WAV"],y={CAPTURE:"/audios/Capture.mp3",CHECK:"/audios/Check.WAV",CHECKMATE:"/audios/Checkmate_Win.WAV",CHECKMATE_LOSE:"/audios/Checkmate_Lose.WAV",DRAW:"/audios/GenericNotify.mp3",ILLEGAL_MOVE:"/audios/Illegal_Move.WAV"};class Le{constructor(){n(this,"_audio");n(this,"_isCurrentlyPlaying");this._audio=new Audio,this._isCurrentlyPlaying=!1}_play(e){this._isCurrentlyPlaying&&this._audio.pause(),this._audio.src=e,this._audio.play(),this._isCurrentlyPlaying=!0,this._audio.addEventListener("ended",()=>{this._isCurrentlyPlaying=!1})}playMove(){this._play(F[Math.floor(Math.random()*F.length)])}playCapture(){this._play(y.CAPTURE)}playCheck(){this._play(y.CHECK)}playCheckmate(){this._play(y.CHECKMATE)}playCheckmateLose(){this._play(y.CHECKMATE_LOSE)}playDraw(){this._play(y.DRAW)}playIllegalMove(){this._play(y.ILLEGAL_MOVE)}}class ke{constructor(e,t,s,i){n(this,"initialBoardState");n(this,"squares");n(this,"currentBoardState");n(this,"player1");n(this,"player2");n(this,"isWhitesTurn");n(this,"moves");n(this,"enPassantAvailableAt");n(this,"hasGameStarted");n(this,"hasGameEnded");n(this,"winner");n(this,"control");n(this,"audioPlayer");this.initialBoardState=e,this.squares=[],this.currentBoardState=e,this.player1=new q(t,!0,this),this.player2=new q(s,!1,this),this.isWhitesTurn=i,this.moves=[],this.enPassantAvailableAt=null,this.initializeSquaresAndPieces(),this.hasGameStarted=!1,this.hasGameEnded=!1,this.winner=null,this.control=null,this.audioPlayer=new Le}get currentPlayer(){return this.isWhitesTurn?this.player1:this.player2}get oponentPlayer(){return this.isWhitesTurn?this.player2:this.player1}get isPlayerVsPlayer(){return!this.player1.isComputer&&!this.player2.isComputer}setControl(e){this.control=e}resetPiecesPositions(){for(let e=0;e<d;e++)for(let t=0;t<m;t++){const s=this.getPiece(t,e);s&&s.handleResetAt(t,e)}}newGame(){var e;he(),this.currentBoardState=[...this.initialBoardState.map(t=>[...t])],this.moves=[],this.enPassantAvailableAt=null,this.resetSquaresAndPieces(),this.hasGameStarted=!1,this.hasGameEnded=!1,this.winner=null,(e=this.control)==null||e.reset(),this.resetPiecesPositions()}startGame(){this.newGame(),this.hasGameStarted=!0}endGame(e=null){e?e.isWhite===this.player1.isWhite?this.audioPlayer.playCheckmate():this.audioPlayer.playCheckmateLose():this.audioPlayer.playDraw(),this.hasGameEnded=!0,this.winner=e}initializeSquaresAndPieces(){this.squares=[];for(let e=0;e<d;e++){this.squares.push([]);for(let t=0;t<m;t++){const s=this.getPiece(t,e),i=new xe(t,e,s);this.squares[e].push(i)}}}resetSquaresAndPieces(){for(let e=0;e<d;e++)for(let t=0;t<m;t++){const s=this.getPiece(t,e);s?this.squares[e][t].setPiece(s):this.squares[e][t].removePiece()}}getPieces(){return this.currentBoardState.flat().filter(e=>e!==null)}getPiece(e,t){return e<0||e>m-1||t<0||t>d-1?null:this.currentBoardState[t][e]??null}getPiecesOfName(e,t){return this.getPieces().filter(s=>s?s.name===e&&E(s.isWhite,t):!1)}getSquare(e,t){return e<0||e>m-1||t<0||t>d-1?null:this.squares[t][e]??null}movePiece(e,t,s){const{fileIndex:i,rankIndex:r}=e;this.currentBoardState[r][i]=null,this.currentBoardState[s][t]=e,e.moveTo(t,s),this.replacePieceAtSquare(e,t,s);const o=this.getSquare(i,r);o==null||o.removePiece(),this.reEvaluateMoves()}reEvaluateMoves(){this.getPieces().forEach(e=>e==null?void 0:e.reEvaluateMoves()),this.getPieces().forEach(e=>e==null?void 0:e.reEvaluateSpecialMoves())}checkIfMoveIsLegal(e,t,s){const{possibleMoves:i,capturablePieces:r}=e.possibleMoves,o=i.some(h=>h[0]===t&&h[1]===s),l=r.some(h=>h[0]===t&&h[1]===s);return o||l}executeMove(e,t,s){if(!this.hasGameStarted||this.hasGameEnded)return;if(!this.checkIfMoveIsLegal(e,t,s))return this.audioPlayer.playIllegalMove(),!1;let i=this.getPiece(t,s);if(i instanceof v)return this.endGame(this.currentPlayer),oe(this.currentPlayer.name,this.oponentPlayer.name),!1;if(e instanceof v)be(this,e,t,s);else if(e instanceof M){const r=Ie(this,t,s,e.isWhite);r&&(i=r)}return this.recordAndMove(e,t,s,i),this.isWhitesTurn=!this.isWhitesTurn,!0}undoLastMove(){if(this.moves.length===0)return!1;const e=this.moves.pop();if(!e)return!1;const{piece:t,oldFileIndex:s,oldRankIndex:i,fileIndex:r,rankIndex:o,capturedPiece:l}=e;return this.movePiece(t,s,i),this.removePieceAtSquare(r,o),l&&(this.replacePieceAtSquare(l,r,o),l.flip()),this.isWhitesTurn=!this.isWhitesTurn,!0}replacePieceAtSquare(e,t,s){const i=this.getSquare(t,s);i&&(i.piece!==null&&i.piece.remove(),i.setPiece(e),this.currentBoardState[s][t]=e)}removePieceAtSquare(e,t){const s=this.getSquare(e,t);s&&(s.piece!==null&&s.piece.remove(),s.removePiece(),this.currentBoardState[t][e]=null)}recordAndMove(e,t,s,i=null){i?this.audioPlayer.playCapture():this.audioPlayer.playMove();const{fileIndex:r,rankIndex:o}=e;this.movePiece(e,t,s),I(this,e.isWhite);const{isInCheck:l}=I(this,!e.isWhite);this.moves.push({piece:e,oldFileIndex:r,oldRankIndex:o,fileIndex:t,rankIndex:s,capturedPiece:i,isCheck:l})}isSquareUnderAttack(e,t,s){const i=this.getPieces().filter(r=>{const o=r.isWhite!==s,l=r instanceof v&&!r.hasMoved;return o&&!l});for(const r of i){const{possibleMoves:o,capturablePieces:l}=r.possibleMoves;if(o.some(h=>h[0]===e&&h[1]===t)||l.some(h=>h[0]===e&&h[1]===t))return!0}return!1}isSquareOccupied(e,t){return this.getPiece(e,t)!==null}isSquareOccupiedOrUnderAttack(e,t,s){return this.isSquareOccupied(e,t)||this.isSquareUnderAttack(e,t,s)}setEnPassantAvailableAt(e){this.enPassantAvailableAt=e}removeEnPassantAvailableAt(){this.enPassantAvailableAt=null}getPlayersKing(e){return e?this.player1.king:this.player2.king}switchToPlayerVsComputer(e){this.player1.switchToPlayer(),this.player2.switchToComputer(e)}switchToComputerVsComputer(e,t){this.player1.switchToComputer(e),this.player2.switchToComputer(t)}switchToPlayerVsPlayer(){this.player1.switchToPlayer(),this.player2.switchToPlayer()}}function O(a){const e=localStorage.getItem(a);return e?JSON.parse(e):null}function H(a,e){localStorage.setItem(a,JSON.stringify(e))}class we{constructor(){n(this,"player1Name");n(this,"player2Name");this.player1Name=O("player1Name")||"White",this.player2Name=O("player2Name")||"Black"}getPlayerName(e){return e?this.player1Name:this.player2Name}changePlayerName(e,t){e?(this.player1Name=t,H("player1Name",t)):(this.player2Name=t,H("player2Name",t))}}class D{constructor(e,t=10*60){n(this,"initialTime");n(this,"time");n(this,"timerInterval");n(this,"timerHtml");this.initialTime=t,this.time=t,this.timerInterval=void 0,this.timerHtml=e,this.render()}start(){this.timerInterval||(this.timerInterval=setInterval(()=>{this.time--,this.render()},1e3))}stop(){clearInterval(this.timerInterval),this.timerInterval=void 0}reset(){this.time=this.initialTime,this.stop(),this.render()}updateInitialTime(e){this.initialTime=e,this.time=e,this.render()}render(){const e=Math.floor(this.time/60),t=this.time%60,s=this.timerHtml.querySelector("[data-minutes]"),i=this.timerHtml.querySelector("[data-seconds]");s.style.setProperty("--value",e.toString()),i.style.setProperty("--value",t.toString())}}const G=10*60;class Ne{constructor(e){n(this,"board");n(this,"gameStartSection");n(this,"playerVsPlayerModeForm");n(this,"playerVsComputerModeForm");n(this,"computerVsComputerModeForm");n(this,"aiTypeForPlayer1");n(this,"aiTypeForPlayer2");n(this,"gameInfoSection");n(this,"playersHtml");n(this,"playerNames");n(this,"playerTimes");n(this,"buttonsDuringGame");n(this,"buttonsAfterGame");n(this,"timeDuration");n(this,"player1Timer");n(this,"player2Timer");this.board=e,this.gameStartSection=document.querySelector(".new-game"),this.playerVsPlayerModeForm=document.querySelector("#player-vs-player-mode-form"),this.playerVsComputerModeForm=document.querySelector("#player-vs-computer-mode-form"),this.computerVsComputerModeForm=document.querySelector("#computer-vs-computer-mode-form"),this.aiTypeForPlayer1=document.querySelectorAll(".ai-type-for-player-1"),this.aiTypeForPlayer2=document.querySelectorAll(".ai-type-for-player-2"),this.gameInfoSection=document.querySelector(".game-info"),this.playersHtml=document.querySelector(".game-info__players"),this.playerNames=document.querySelectorAll(".game-info__player-name"),this.playerTimes=document.querySelectorAll(".game-info__player-time"),this.buttonsDuringGame=document.querySelector(".during-game"),this.buttonsAfterGame=document.querySelector(".after-game"),this.timeDuration=G,this.player1Timer=new D(this.playerTimes[0],this.timeDuration),this.player2Timer=new D(this.playerTimes[1],this.timeDuration),this.fillOptionsForAiType(),this.fillExistingNameOfPlayers(),this.initializeEventListenerForPlayerVsPlayerModeForm(),this.initializeEventListenerForPlayerVsComputerModeForm(),this.initializeEventListenerForComputerVsComputerModeForm(),this.initializeEventListenerForUndoButton(),this.initializeEventListenerForDrawButton(),this.initializeEventListenerForResignButton(),this.initializeEventListenerForNewGameButton(),this.initializeEventListenerForRestartButton(),this.renderLoop()}get gameState(){return this.board.gameState}get shouldActivateTimers(){return this.gameState.isPlayerVsPlayer}handleGameStart(){this.gameState.startGame(),this.gameStartSection.classList.add("hidden"),this.gameInfoSection.classList.remove("hidden")}fillOptionsForAiType(){ce.forEach(e=>{const t=document.createElement("option");t.value=e,t.textContent=e,e===B&&t.setAttribute("selected","true"),this.aiTypeForPlayer1.forEach(s=>{s.appendChild(t.cloneNode(!0))}),this.aiTypeForPlayer2.forEach(s=>{s.appendChild(t.cloneNode(!0))})})}fillExistingNameOfPlayers(){if(this.board.player1Name){const e=document.getElementById("player1-name");e.value=this.board.player1Name}if(this.board.player2Name){const e=document.getElementById("player2-name");e.value=this.board.player2Name}}initializeEventListenerForPlayerVsPlayerModeForm(){this.playerVsPlayerModeForm.addEventListener("submit",e=>{e.preventDefault();const t=new FormData(this.playerVsPlayerModeForm),s=t.get("duration"),i=t.get("player1-name"),r=t.get("player2-name");s&&(this.timeDuration=parseInt(s)||G,this.player1Timer.updateInitialTime(this.timeDuration),this.player2Timer.updateInitialTime(this.timeDuration)),i&&this.board.changePlayerName(!0,i),r&&this.board.changePlayerName(!1,r),this.gameState.switchToPlayerVsPlayer(),this.handleGameStart()})}initializeEventListenerForPlayerVsComputerModeForm(){this.playerVsComputerModeForm.addEventListener("submit",e=>{e.preventDefault();const s=new FormData(this.playerVsComputerModeForm).get("aiTypeForPlayer2");this.gameState.switchToPlayerVsComputer(s),this.handleGameStart()})}initializeEventListenerForComputerVsComputerModeForm(){this.computerVsComputerModeForm.addEventListener("submit",e=>{e.preventDefault();const t=new FormData(this.computerVsComputerModeForm),s=t.get("aiTypeForPlayer1"),i=t.get("aiTypeForPlayer2");this.gameState.switchToComputerVsComputer(s,i),this.handleGameStart()})}initializeEventListenerForUndoButton(){document.querySelector("#undoMove").addEventListener("click",()=>{this.gameState.undoLastMove()})}initializeEventListenerForDrawButton(){document.querySelector("#offerDraw").addEventListener("click",()=>{this.gameState.hasGameEnded||(this.gameState.endGame(),ne())})}initializeEventListenerForResignButton(){document.querySelector("#resign").addEventListener("click",()=>{this.gameState.hasGameEnded||(this.gameState.endGame(this.gameState.oponentPlayer),le(this.gameState.oponentPlayer.name))})}initializeEventListenerForNewGameButton(){document.querySelector("#newGame").addEventListener("click",()=>{this.gameState.newGame(),this.resetTimers(),this.gameStartSection.classList.remove("hidden"),this.gameInfoSection.classList.add("hidden")})}initializeEventListenerForRestartButton(){document.querySelector("#restart").addEventListener("click",()=>{this.gameState.startGame(),this.resetTimers()})}updatePlayerNames(){this.playerNames.length===2&&(this.playerNames[0].textContent=this.board.player1Name,this.playerNames[1].textContent=this.board.player2Name)}switchTimer(){this.shouldActivateTimers&&(this.gameState.isWhitesTurn?(this.player1Timer.start(),this.player2Timer.stop()):(this.player1Timer.stop(),this.player2Timer.start()))}stopTimer(){this.shouldActivateTimers&&(this.gameState.isWhitesTurn?this.player1Timer.stop():this.player2Timer.stop())}resetTimers(){this.shouldActivateTimers&&(this.player1Timer.reset(),this.player2Timer.reset())}handleTimeOut(){this.shouldActivateTimers&&(this.player1Timer.time<=0?(this.gameState.endGame(this.gameState.player2),N(this.gameState.player2.name),this.player1Timer.stop()):this.player2Timer.time<=0&&(this.gameState.endGame(this.gameState.player1),N(this.gameState.player1.name),this.player2Timer.stop()))}hidePlayerTimes(){for(const e of this.playerTimes)e.classList.add("hidden")}showPlayerTimes(){for(const e of this.playerTimes)e.classList.remove("hidden")}renderLoop(){this.gameState.hasGameEnded?(this.buttonsDuringGame.classList.add("hidden"),this.buttonsAfterGame.classList.remove("hidden"),this.stopTimer()):this.gameState.hasGameStarted&&(this.buttonsDuringGame.classList.remove("hidden"),this.buttonsAfterGame.classList.add("hidden"),this.updatePlayerNames(),re(this.gameState.currentPlayer.name),this.handleTimeOut(),this.shouldActivateTimers?this.showPlayerTimes():this.hidePlayerTimes(),this.gameState.isWhitesTurn?(this.playersHtml.classList.remove("game-info__players--reverse"),this.shouldActivateTimers&&(this.player2Timer.stop(),this.player1Timer.start())):(this.playersHtml.classList.add("game-info__players--reverse"),this.shouldActivateTimers&&(this.player1Timer.stop(),this.player2Timer.start()))),requestAnimationFrame(()=>{this.renderLoop()})}}class qe{constructor(e,t,s=!0){n(this,"boardId");n(this,"htmlElement");n(this,"store");n(this,"player1Name");n(this,"player2Name");n(this,"gameState");n(this,"control");n(this,"uiContorl");n(this,"playerNameBlack");n(this,"playerNameWhite");if(this.boardId=e,this.htmlElement=document.getElementById(e),!this.htmlElement)throw new Error(`Element with id ${e} not found`);this.store=new we,this.player1Name=this.store.getPlayerName(!0),this.player2Name=this.store.getPlayerName(!1),this.gameState=new ke(t,this.player1Name,this.player2Name,s),this.control=new _e(this.htmlElement,this.gameState),this.uiContorl=new Ne(this),this.gameState.setControl(this.control),this.playerNameBlack=this.generatePlayerName(!1),this.playerNameWhite=this.generatePlayerName(!0),this.renderLoop()}fixOrientation(){this.control.fixBoardOrientation()}initializeEventListnersForSquare(e){const t=e.getHtmlElement();t.addEventListener("dragenter",()=>{this.control.isSquareHighlighted(e,c.VALID)&&e.highlight(c.HOVER)}),t.addEventListener("dragleave",()=>{this.control.isSquareHighlighted(e,c.VALID)&&e.removeHighlight(c.HOVER)}),t.addEventListener("drop",()=>{const{fileIndex:s,rankIndex:i}=e;this.control.handleMoveSelectedPieceTo(s,i),e.removeHighlight(c.HOVER)}),t.addEventListener("dragover",s=>{s.preventDefault()}),t.addEventListener("click",()=>{const{fileIndex:s,rankIndex:i}=e;this.control.handleMoveSelectedPieceTo(s,i),e.removeHighlight(c.HOVER)})}generateBoardContainer(){const e=document.createElement("div");return e.classList.add("chess-board__board-container"),e}generateRow(){const e=document.createElement("div");return e.classList.add("chess-board__row"),e}generatePlayerName(e){const t=document.createElement("input");return t.classList.add("chess-board__player-name"),t.classList.add(e?"chess-board__player-name--white":"chess-board__player-name--black"),t.value=e?this.player1Name:this.player2Name,t.addEventListener("change",s=>{this.changePlayerName(e,s.target.value)}),t}changePlayerName(e,t){e?(this.player1Name=t,this.gameState.player1.updateName(t),this.playerNameWhite.value=t):(this.player2Name=t,this.gameState.player2.updateName(t),this.playerNameBlack.value=t),this.store.changePlayerName(e,t)}reEvaluateGameState(){this.gameState.reEvaluateMoves(),I(this.gameState,!0),I(this.gameState,!1)}render(){const e=this.htmlElement;e.innerHTML="",e.appendChild(this.playerNameBlack);const t=this.generateBoardContainer();for(let s=d-1;s>=0;s--){const i=this.generateRow();for(let r=0;r<m;r++){const o=this.gameState.getSquare(r,s);if(!o)throw new Error(`Square not found at ${r}, ${s}`);const l=o.getHtmlElement();this.initializeEventListnersForSquare(o);const h=this.gameState.getPiece(r,s);h&&(o.setPiece(h),h.setControl(this.control)),i.appendChild(l)}t.appendChild(i)}return e.appendChild(t),e.appendChild(this.playerNameWhite),e}renderLoop(){this.gameState.hasGameStarted&&this.fixOrientation(),requestAnimationFrame(()=>{this.renderLoop()})}}function Fe(a){const[e,t,s,i,r,o]=a.split(" "),l=[],h=e.split("/");for(const A of h){const f=[];for(const _ of A)if(isNaN(Number(_)))f.push(_);else{const $=Array(parseInt(_)).fill(null);f.push(...$)}l.push(f)}return{board:l,turn:t,castling:s,enPassant:i,halfMoveClock:r,fullMoveNumber:o}}function Oe(a){switch(a){case"p":return M;case"n":return z;case"b":return V;case"r":return K;case"q":return U;case"k":return v;default:throw new Error(`Invalid piece ${a}`)}}function He(a){const e=[];for(let t=0;t<a.length;t++){const s=a[t],i=[];for(let r=0;r<s.length;r++){const o=s[r];if(o){const l=o===o.toUpperCase(),h=Oe(o.toLowerCase());i.push(new h(l,m-r,d-t,void 0,o.toUpperCase()))}else i.push(null)}e.push(i.reverse())}return e.reverse()}const De=(a,e=J)=>{const{board:t,turn:s}=Fe(e),i=He(t);return new qe(a,i,s?s==="w":!0)},Re=`
<div class="container main">
      <section class="chess-board">
        <div id="board" class="chess-board__container">
        </div>
      </section>
      <section class="new-game">
        <h2>Play a New Game</h2>
        <form id="player-vs-player-mode-form" class="flex flex-col gap-4 items-center justify-center">
          <div class="form-group">
            <label for="player1-name">Player/Computer 1's Name</label>
            <input type="text" id="player1-name" name="player1-name" class="input input-bordered w-full max-w-xs"
              placeholder="Enter player/computer 1's name">
          </div>
          <div class="form-group">
            <label for="player2-name">Player/Computer 2's Name</label>
            <input type="text" id="player2-name" name="player2-name" class="input input-bordered w-full max-w-xs"
              placeholder="Enter player/computer 2's name">
          </div>

          <div class="form-group">
            <label for="duration">Duration</label>
            <select id="duration" name="duration" class="input input-bordered w-full max-w-xs">
              <option value="60">1 min</option>
              <option value="180">3 min</option>
              <option value="300">5 min</option>
              <option value="600" selected>10 min</option>
              <option value="1800">30 min</option>
            </select>
          </div>

          <button type="submit" class="btn btn-primary new-player-vs-player"
            title="Play with another player on the same screen turn by turn">New Game
            (Player vs Player)</button>
        </form>
        <form id="player-vs-computer-mode-form" class="flex flex-col gap-4 items-center justify-center">
          <div class="form-group">
            <label for="aiTypeForPlayer2">AI Type (Computer 2)</label>
            <select id="aiTypeForPlayer2" name="aiTypeForPlayer2" class="input input-bordered w-full max-w-xs ai-type-for-player-2">
            </select>
          </div>

          <button type="submit" class="btn btn-primary new-player-vs-computer"
            title="Play with Computerof your choice">New
            Game (Player vs
            Computer)</button>
        </form>
        <form id="computer-vs-computer-mode-form" class="flex flex-col gap-4 items-center justify-center">
          <div class="form-group">
            <label for="aiTypeForPlayer1">AI Type (Computer 1)</label>
            <select id="aiTypeForPlayer1" name="aiTypeForPlayer1" class="input input-bordered w-full max-w-xs ai-type-for-player-1">
            </select>
          </div>
          <div class="form-group">
            <label for="aiTypeForPlayer2">AI Type (Computer 2)</label>
            <select id="aiTypeForPlayer2" name="aiTypeForPlayer2" class="input input-bordered w-full max-w-xs ai-type-for-player-2">
            </select>
          </div>
          <button type="submit" class="btn btn-primary new-computer-vs-computer"
            title="Watch Computer play against itself">New
            Game (Computer vs Computer)</button>
        </form>
      </section>
      <section class="game-info hidden">
        <div class="game-info__players">
          <div class="game-info__player">
            <p class="game-info__player-name">Player 1</p>
            <!--p class="game-info__player-time">10:00</p-->
            <span class="game-info__player-time countdown">
              <span data-minutes style="--value:10;"></span>:
              <span data-seconds style="--value:00;"></span>
            </span>
          </div>
          <div class="game-info__player">
            <p class="game-info__player-name">Player 2</p>
            <!--p class="game-info__player-time">10:00</p-->
            <span class="game-info__player-time countdown">
              <span data-minutes style="--value:10;"></span>:
              <span data-seconds style="--value:00;"></span>
            </span>
          </div>
        </div>

        <div>
          <p id="gameStatusText">Player 1 turn</p>
        </div>

        <div class="game-info__buttons during-game">
          <button id="undoMove" class="btn btn-outline btn-primary"><i class="fa-solid fa-backward"></i>
            <span>Undo</span></button>
          <button id="offerDraw" class="btn btn-outline btn-primary"><i
              class="fa-solid fa-handshake"></i><span>Draw</span></button>
          <button id="resign" class="btn btn-outline btn-primary"><i
              class="fa-solid fa-flag"></i><span>Resign</span></button>
        </div>

        <div class="game-info__buttons after-game hidden">
          <button id="newGame" class="btn btn-outline btn-primary"><i class="fa-solid fa-plus"></i>
            <span>New Game</span></button>
          <button id="restart" class="btn btn-outline btn-primary"><i
              class="fa-solid fa-rotate-left"></i></i><span>Rematch</span></button>
        </div>

        <table class="game-info__history hidden">
          <thead>
            <tr>
              <th>Move</th>
              <th>White</th>
              <th>Black</th>
            </tr>
          </thead>
          <tbody>
          </tbody>
        </table>

        <div class="game-info__buttons hidden">
          <i class="fa-solid fa-backward-fast"></i>
          <i class="fa-solid fa-backward-step"></i>
          <i class="fa-solid fa-forward-step"></i>
          <i class="fa-solid fa-forward-fast"></i>
        </div>
      </section>
    </div>
`;function Ge(){const a=De(Z);a.render(),a.reEvaluateGameState(),ae()}function Ue(){Ge()}export{Ue as afterInitialize,Re as component};
